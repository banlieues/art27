
<?php if(!isset($interface)): $interface=NULL; endif;?>

<script>
 var scenario = {};
    scenario["primefin1"]="1,8";
    scenario["primefin2"]="2,8";
    scenario["3"] = "1,1";
    scenario["4"] = "2,1";
    scenario["5"] = "1,2";
    scenario["6"] = "2,2";
    scenario["7"] = "1,3";
    scenario["8"] = "2,3";
    scenario["9"] = "1,4";
    scenario["10"] = "2,4";
	scenario["id_type_demande_one_choice"] = "2,4";
    scenario["11"] = "1,5";
    scenario["12"] = "2,5";
    scenario["13"] = "1,6";
    scenario["14"] = "2,6";
    scenario["15"]="5,1";
    scenario["16"]="5,1";
    scenario["17"]="5,2";
    scenario["18"]="5,2";
    scenario["19"]="5,3";
    scenario["20"]="5,3";
    scenario["21"]="5,4";
    scenario["22"]="5,4";
    scenario["23"]="5,6";
    scenario["24"]="5,6";
    scenario["25"]="7,2";
    scenario["26"]="2,5;7,3;10,1";
	scenario["26"]="2,5;7,3;id_type_demande_one_choice,1";
    scenario["27"]="4,3";
    scenario["28"]="4,3";
//    scenario["29"]="1,2;4,9;10,3";
//    scenario["30"]="2,2;4,9;10,3";

    scenario["29"]="4,9";
   scenario["30"]="4,9";

    scenario["48"]="18,6";
    scenario["200"] = "1,7";
    scenario["201"] = "2,7";
    scenario["300"]="4,8";
   //accompagnement
   //num element: //3,4,5,6,7,8,9,11,12,13,14,15,16,17,200
    scenario["aprimefin1"]="a1,8";
    scenario["aprimefin2"]="a2,8";

    scenario["a3"] = "a1,1";
    scenario["a4"] = "a2,1";
    scenario["a5"] = "a1,2";
    scenario["a6"] = "a2,2";
    scenario["a7"] = "a1,3";
    scenario["a8"] = "a2,3";
    scenario["a9"] = "a1,4";
    scenario["a10"] = "a2,4";
    scenario["a11"] = "a1,5";
    scenario["a12"] = "a2,5";
    scenario["a13"] = "a1,6";
    scenario["a14"] = "a2,6";
    scenario["a27"]="a4,3";
    scenario["a28"]="a4,3";
//    scenario["a29"]="a1,2;a4,9;10,3";
//    scenario["a30"]="a2,2;a4,9;10,3";
 
    scenario["a29"]="a4,9";
   scenario["a30"]="a4,9";
   
    scenario["a48"]="a18,6";
    scenario["a200"]="a1,7";
    scenario["a201"]="a2,7";
    scenario["a300"]="a4,8";
    scenario["a15"]="a5,1";
    
    
        scenario["a15"]="a5,1";
    scenario["a16"]="a5,1";
    scenario["a17"]="a5,2";
    scenario["a18"]="a5,2";
    scenario["a19"]="a5,3";
    scenario["a20"]="a5,3";
    scenario["a21"]="a5,4";
    scenario["a22"]="a5,4";
    scenario["a23"]="a5,6";
    scenario["a24"]="a5,6";
    scenario["a25"]="a7,2";
//    scenario["a25"]="a1,5;a7,3;10,1";
//    scenario["a26"]="a2,5;a7,3;10,1";

    
    
//visiteur
    scenario["v300"]="v4,8";
    scenario["vprimefin1"]="v1,8";
    scenario["vprimefin2"]="v2,8";
    scenario["v3"] = "v1,1";
    scenario["v4"] = "v2,1";
    scenario["v5"] = "v1,2";
    scenario["v6"] = "v2,2";
    scenario["v7"] = "v1,3";
    scenario["v8"] = "v2,3";
    scenario["v9"] = "v1,4";
    scenario["v10"] = "v2,4";
	scenario["id_type_demande_one_choice"] = "v2,4";
    scenario["v11"] = "v1,5";
    scenario["v12"] = "v2,5";
    scenario["v13"] = "v1,6";
    scenario["v14"] = "v2,6";
    scenario["v15"]="v5,1";
   
//    scenario["v17"]="v1,3;v5,2;10,1";
//    scenario["v18"]="v2,3;v5,2;10,1";
//    scenario["v19"]="v1,3;v5,3;10,1";
//    scenario["v20"]="v2,3;v5,3;10,1";
//    scenario["v21"]="v1,3;v5,4;10,1";
//    scenario["v22"]="v2,3;v5,4;10,1";
//    scenario["v23"]="v1,3;v5,6;10,1";
//    scenario["v24"]="v2,3;v5,6;10,1";
//    scenario["v25"]="v1,5;v7,3;10,1";
//    scenario["v26"]="v2,5;v7,3;10,1";
scenario["v25"]="v7,2";
    scenario["v27"]="v4,3";
    scenario["v28"]="v4,3";
    scenario["v29"]="v4,9";
    scenario["v30"]="v4,9";
    scenario["v48"]="v18,6";
    scenario["v200"] = "v1,7";
    scenario["v201"] = "v2,7";
    
    scenario["v15"]="v5,1";
    scenario["v16"]="v5,1";
    scenario["v17"]="v5,2";
    scenario["v18"]="v5,2";
    scenario["v19"]="v5,3";
    scenario["v20"]="v5,3";
    scenario["v21"]="v5,4";
    scenario["v22"]="v5,4";
    scenario["v23"]="v5,6";
    scenario["v24"]="v5,6";
    
 	scenario["31"]="10,3";
    scenario["32"]="10,1";
    scenario["33"]="10,2";
    scenario["34"]="10,3";
    scenario["35"]="10,6";

	scenario["31"]="id_type_demande_one_choice,3";
    scenario["32"]="id_type_demande_one_choice,1";
    scenario["33"]="id_type_demande_one_choice,2";
    scenario["34"]="id_type_demande_one_choice,3";
    scenario["35"]="id_type_demande_one_choice,6";


    scenario["42"]="18,1";
    scenario["43"]="18,1";
    scenario["44"]="18,1";
    scenario["45"]="18,1";
    scenario["46"]="18,2";
    scenario["47"]="18,2";
   
    scenario["49"]="19,2";
    scenario["50"]="19,3";
    scenario["51"]="19,2";
    scenario["52"]="19,3";

    scenario["57"]="21,1";
    scenario["58"]="21,1";

    scenario["60"]="20,1";
    scenario["61"]="20,1";
    scenario["62"]="20,1";
    scenario["63"]="20,1";
    scenario["123"]="122,1";
    scenario["125"]="124,6";
    scenario["126"]="18,2";
    scenario["127"]="18,3";
    scenario["128"]="18,3";
    scenario["129"]="18,3";
    scenario["130"]="18,4";
    scenario["131"]="10,2";
    scenario["132"]="10,2";
    scenario["133"]="10,2";
    scenario["134"]="10,2";

	scenario["131"]="id_type_demande_one_choice,2";
    scenario["132"]="id_type_demande_one_choice,2";
    scenario["133"]="id_type_demande_one_choice,2";
    scenario["134"]="id_type_demande_one_choice,2";

    scenario["203"]="1,7";
    scenario["200"] = "1,7";
    scenario["201"] = "2,7";

    scenario["189"]= "10,3";
    scenario["189bis"]= "10,2";
    scenario["191"]="10,2";

	scenario["189"]= "id_type_demande_one_choice,3";
    scenario["189bis"]= "id_type_demande_one_choice,2";
    scenario["191"]="id_type_demande_one_choice,2";
      
    var element={}
    element["1"]="demande_id_thematique_principal";
    element["2"]="demande_id_thematique_secondaire";
    
    element["a1"]="accompagnement_demande_id_thematique_principal";
    element["a2"]="accompagnement_demande_id_thematique_secondaire";
    
    element["v1"]="visite_demande_id_thematique_principal";
    element["v2"]="visite_demande_id_thematique_secondaire";
    
    element["18"]="demande_id_type_accompagnement";
    element["a18"]="accompagnement_demande_id_type_accompagnement";
    element["v18"]="visite_demande_id_type_accompagnement";
    //information
    element["primefin"]="demande_id_prime";
    element["3"]="demande_id_th_acoustique";//Ok
    element["4"]="demande_id_th_energie";//Ok
    element["16"]="demande_id_ths_isolation";//OK
    element["17"]="demande_id_ths_energie_renouvelable";//OK
    element["5"]="demande_id_th_logement";//Ok
    element["9"]="demande_id_ths_aide_locative";//Ok
    element["11"]="demande_id_ths_aide_achat";//Ok
    element["12"]="demande_id_ths_aide_juridique";//Ok
    element["13"]="demande_id_ths_insalubrite";//Ok
    element["14"]="demande_id_ths_logement_inoccupe";//Ok
    element["7"]="demande_id_th_patrimoine";//Ok
    element["15"]="demande_id_ths_petit_patrimoine";//Ok
    element["6"]="demande_id_th_renovation";//Ok
    element["8"]="demande_id_th_urbanisme";//Ok
    element["200"]="demande_id_ths_batiment_durable";//Ok
    element["300"]="demande_id_ths_peb",
    //accompagnement
    element["aprimefin"]="accompagnement_demande_id_prime";
    element["a3"]="accompagnement_demande_id_th_acoustique";//Ok
    element["a4"]="accompagnement_demande_id_th_energie";//Ok
    element["a16"]="accompagnement_demande_id_ths_isolation";//OK
    element["a17"]="accompagnement_demande_id_ths_energie_renouvelable";//OK
    element["a5"]="accompagnement_demande_id_th_logement";//Ok
    element["a9"]="accompagnement_demande_id_ths_aide_locative";//Ok
    element["a11"]="accompagnement_demande_id_ths_aide_achat";//Ok
    element["a12"]="accompagnement_demande_id_ths_aide_juridique";//Ok
    element["a13"]="accompagnement_demande_id_ths_insalubrite";//Ok
    element["a14"]="accompagnement_demande_id_ths_logement_inoccupe";//Ok
    element["a7"]="accompagnement_demande_id_th_patrimoine";//Ok
    element["a15"]="accompagnement_demande_id_ths_petit_patrimoine";//Ok
    element["a6"]="accompagnement_demande_id_th_renovation";//Ok
    element["a8"]="accompagnement_demande_id_th_urbanisme";//Ok
    element["a200"]="accompagnement_demande_id_ths_batiment_durable";//Ok
  
    //visite
    element["vprimefin"]="demande_id_prime";
     element["v3"]="visite_demande_id_th_acoustique";//Ok
    element["v4"]="visite_demande_id_th_energie";//Ok
    element["v16"]="visite_demande_id_ths_isolation";//OK
    element["v17"]="visite_demande_id_ths_energie_renouvelable";//OK
    element["v5"]="visite_demande_id_th_logement";//Ok
    element["v9"]="visite_demande_id_ths_aide_locative";//Ok
    element["v11"]="visite_demande_id_ths_aide_achat";//Ok
    element["v12"]="visite_demande_id_ths_aide_juridique";//Ok
    element["v13"]="visite_demande_id_ths_insalubrite";//Ok
    element["v14"]="visite_demande_id_ths_logement_inoccupe";//Ok
    element["v7"]="visite_demande_id_th_patrimoine";//Ok
    element["v15"]="visite_demande_id_ths_petit_patrimoine";//Ok
    element["v6"]="visite_demande_id_th_renovation";//Ok
    element["v8"]="visite_demande_id_th_urbanisme";//Ok
    element["v200"]="visite_demande_id_ths_batiment_durable";//Ok
    
   
    element["10"]="id_type_demande";
    
	element["id_type_demande_one_choice"]="id_type_demande_one_choice";
    
    
    element["19"]="id_type_bien_coche";
	
  	element["20"]="is_professionel_pro";
    element["21"]="id_type_personne";
    element["122"]="is_rappel";
    element["123"]="date_tache_rappel";
    element["124"]="type_tache";
    element["125"]="type_tache_libre";
    element["126"]="demande_th_regularisation";
    element["127"]="demande_nb_coproprio";
    element["128"]="demande_id_th_ag";
    element["129"]="demande_id_th_visite";
    element["130"]="demande_id_type_projet";
    element["131"]="demande_id_geste";
    element["132"]="demande_id_intervention";
    element["133"]="demande_id_intervention_non";
    element["134"]="demande_id_travaux";
 
    
    
    var numero={}  
  //numero["31"]="demande_id_type_accompagnement";
//    numero["32,33,34,35"]="demande_id_thematique_principal";
//    

//numero["36,37,38,39,40,41"]="demande_id_thematique_secondaire";


    
//information
    numero["189"]="demande_id_type_accompagnement";
    //numero["190,190bis"]="demande_id_prime";
    numero["191"]="demande_id_visite";
    numero["primefin1,primefin2"]="demande_id_prime";

    numero["3,4"]="demande_id_th_acoustique";//OK
    numero["5,6"]="demande_id_th_energie";//OK
    numero["27,28"]="demande_id_ths_isolation";//OK
    numero["29,30"]="demande_id_ths_energie_renouvelable";
    numero["7,8"]="demande_id_th_logement";//OK
    numero["15"]="demande_id_ths_aide_locative";//OK
    numero["17"]="demande_id_ths_aide_achat";//OK
    numero["19"]="demande_id_ths_aide_juridique";//OK
    numero["21"]="demande_id_ths_insalubrite";//OK
    numero["23"]="demande_id_ths_logement_inoccupe";//OK
    numero["11,12"]="demande_id_th_patrimoine";//OK
    //numero["25,26,48"]="demande_id_ths_petit_patrimoine";//
        numero["25"]="demande_id_ths_petit_patrimoine";//

    numero["9,10"]="demande_id_th_renovation";//OK

	//numero["9,id_type_demande_one_choice"]="demande_id_th_renovation";//OK

    numero["13,14"]="demande_id_th_urbanisme";//OK
    numero["200,201"]=  "demande_id_ths_batiment_durable";
    numero["300"]= "demande_id_ths_peb";
  //Accompagnement
    numero["aprimefin1,aprimefin2"]="accompagnement_demande_id_prime";
    numero["a3,a4"]="accompagnement_demande_id_th_acoustique";
    numero["a5,a6"]="accompagnement_demande_id_th_energie";
    numero["a27,a28"]="accompagnement_demande_id_ths_isolation";
    numero["a29,a30"]="accompagnement_demande_id_ths_energie_renouvelable";
    numero["a7,a8"]="accompagnement_demande_id_th_logement";
    numero["a15"]="accompagnement_demande_id_ths_aide_locative";
    numero["a17"]="accompagnement_demande_id_ths_aide_achat";
    numero["a19"]="accompagnement_demande_id_ths_aide_juridique";
    numero["a21"]="accompagnement_demande_id_ths_insalubrite";
    numero["a23"]="accompagnement_demande_id_ths_logement_inoccupe";
    numero["a11,a12"]="accompagnement_demande_id_th_patrimoine";
    numero["a25"]="accompagnement_demande_id_ths_petit_patrimoine";
    numero["a9,a10"]="accompagnement_demande_id_th_renovation";
    numero["a13,a14"]="accompagnement_demande_id_th_urbanisme";
    numero["a200,a201"]=  "accompagnement_demande_id_ths_batiment_durable";
    numero["a300"]= "accompagnement_demande_id_ths_peb";
    
    numero["ac9000"]="accompagnement_demande_id_ths_petit_patrimoine_acc";
    numero["dd9000"]="demande_id_ths_petit_patrimoine_acc";
    scenario["ac9000"]="a18,6";
    scenario["dd9000"]="18,6";
    
	//element["id_type_info_conseil"]="id_type_info_conseil";
	/*numero["id_type_info_conseil"]="id_type_info_conseil";
	scenario["id_type_info_conseil"]="10,1";*/

	numero["demande_id_type_info_conseil"]="demande_id_type_info_conseil";
	scenario["demande_id_type_info_conseil"]="id_type_demande_one_choice,1";

	numero["demande_type_suivi_accompagnement"]="demande_type_suivi_accompagnement";
	scenario["demande_type_suivi_accompagnement"]="id_type_demande_one_choice,3";

	/*numero["accompagnement_id_type_suivi_accompagnement"]="accompagnement_id_type_suivi_accompagnement";
	scenario["accompagnement_id_type_suivi_accompagnement"]="10,3";*/
	//scenario["accompagnement_id_type_suivi_accompagnement"]="id_type_demande_one_choice,3";
    
   //visite
       numero["vprimefin1,vprimefin2"]="visite_demande_id_prime";

    numero["v3,v4"]="visite_demande_id_th_acoustique";
    numero["v5,v6"]="visite_demande_id_th_energie";
    numero["v27,v28"]="visite_demande_id_ths_isolation";
    numero["v29,v30"]="visite_demande_id_ths_energie_renouvelable";
    numero["v7,v8"]="visite_demande_id_th_logement";
    numero["v15"]="visite_demande_id_ths_aide_locative";
    numero["v17"]="visite_demande_id_ths_aide_achat";
    numero["v19"]="visite_demande_id_ths_aide_juridique";
    numero["v21"]="visite_demande_id_ths_insalubrite";
    numero["v23"]="visite_demande_id_ths_logement_inoccupe";
    numero["v11,v12"]="visite_demande_id_th_patrimoine";
    numero["v25"]="visite_demande_id_ths_petit_patrimoine";
    numero["v9,v10"]="visite_demande_id_th_renovation";
    numero["v13,v14"]="visite_demande_id_th_urbanisme";
    numero["v200,v201"]=  "visite_demande_id_ths_batiment_durable";
    numero["v300"]= "visite_demande_id_ths_peb";
   
    
    
    
    
   
   
   numero["42"]="demande_id_objet_pvb";
   numero["43"]="demande_date_pvb";
   numero["44"]="demande_id_credit_pvb";
   numero["45"]="demande_id_revenu";
    numero["46"]="demande_id_objet_permis";
    numero["47"]="demande_id_raison_permis";
    if(window.location.href.includes('demande/new')) numero["49"]="etage_logement_bien";
    numero["50"]="id_nombre_bien";
    numero["51,52"]="id_chauffage_bien";
    
    numero["57"]="nom_personne_pro";
    numero["58"]="prenom_personne_pro";
    //numero["59"]="web_personne_pro";
//    numero["53"]="organisme_nom";
//    numero["54"]="organisme_service";
//    numero["55"]="fonction_organisme";
//    numero["56"]="type_organisme";
    numero["60"]="lien_homegrade_pro";
    numero["61"]="remarque_pro";
    numero["62"]="is_point_pro";
    numero["63"]="is_vip_pro";
    
  
    numero["123"]="date_tache_rappel";
   
    numero["125"]="type_tache_libre";
    numero["126"]="demande_th_regularisation";
     numero["127"]="demande_nb_coproprio";
    numero["128"]="demande_id_th_ag";
    numero["129"]="demande_id_th_visite";
    numero["130"]="demande_id_type_projet";
    numero["131"]="demande_id_geste";
    numero["132"]="demande_id_intervention";
    numero["133"]="demande_id_intervention_non";
    numero["134"]="demande_id_travaux";
   
    numero["a126s"]="accompagnement_demande_th_regularisation";
    numero["a127s"]="accompagnement_demande_nb_coproprio";
    numero["a128s"]="accompagnement_demande_id_th_ag";
    numero["a130s"]="accompagnement_demande_id_type_projet";
    numero["a42s"]="accompagnement_demande_id_objet_pvb";
   numero["a43s"]="accompagnement_demande_date_pvb";
   numero["a44s"]="accompagnement_demande_id_credit_pvb";
   numero["a45s"]="accompagnement_demande_id_revenu";
    numero["a46s"]="accompagnement_demande_id_objet_permis";
    numero["a47s"]="accompagnement_demande_id_raison_permis";
 
    
     scenario["a42s"]="a18,1";
    scenario["a43s"]="a18,1";
    scenario["a44s"]="a18,1";
    scenario["a45s"]="a18,1";
    scenario["a46s"]="a18,2";
    scenario["a47s"]="a18,2";
    
     scenario["a126s"]="a18,2";
    scenario["a127s"]="a18,3";
    scenario["a128s"]="a18,3";
   
    scenario["a130s"]="a18,4";



element["demande_reglementation"]="demande_id_ths_reglementation";
element["accompagnement_reglementation"]="accompagnement_id_ths_reglementation";
element["visite_reglementation"]="visite_id_ths_reglementation";

numero["demande_reglementation"]="demande_id_ths_reglementation";
numero["accompagnement_reglementation"]="accompagnement_id_ths_reglementation";
numero["visite_reglementation"]="visite_id_ths_reglementation";

scenario["demande_reglementation"]="8,4";
scenario["accompagnement_reglementation"]="a8,4";
scenario["visite_reglementation"]="v8,4";


  function set_ssth(container_encours)
  {
	//container_encours=$("body");
	//alert();
     var check_thematique_principal=$("input[name_visibility='demande_id_thematique_principal']",container_encours).val();
     var check_accompagnement=$("input[name_visibility='demande_id_type_accompagnement']",container_encours).val();
     var check_id_demande=$("input[name_visibility='id_type_demande']",container_encours).val();

	 
    
	if(check_id_demande!="undefined")
	{
			var check_id_demande=$("input[name_visibility='id_type_demande_one_choice']",container_encours).val();
	}

	

     if(check_id_demande==3)
     {
	
		if(check_thematique_principal>0)	
		{
			$(".tr_fiche_demande_id_thematique_principal",container_encours).find(".control-label").text("Thématique d'entrée");
			$(".tr_fiche_demande_id_type_accompagnement",container_encours).find(".control-label").text("Type d'acc. spécifique");
		
			//alert();
		}

		else if (check_accompagnement>0)
		{
			
			$(".tr_fiche_demande_id_thematique_principal",container_encours).find(".control-label").text("Thématique d'entrée");
			$(".tr_fiche_demande_id_type_accompagnement",container_encours).find(".control-label").text("Type d'acc. spécifique");
			//alert();
		}
		else
		{
			
			$(".tr_fiche_demande_id_thematique_principal",container_encours).find(".control-label").text("* Thématique d'entrée");
			$(".tr_fiche_demande_id_type_accompagnement",container_encours).find(".control-label").text("* Type d'acc. spécifique   ");
			//alert();

		}
     }
     
     if(check_id_demande==1)
     {
	 	//alert(check_thematique_principal);
	 	if(check_thematique_principal>0)
		{
			$(".tr_fiche_demande_id_thematique_principal",container_encours).find(".control-label").text("* Thématique d'entrée");
		
			//alert();
		}
		
		
		else
		{
			$(".tr_fiche_demande_id_thematique_principal",container_encours).find(".control-label").text("* Thématique d'entrée");
			//alert();

		}
     }
     

     
    //container_encours=$("body");

    
    var is_affiche=false; 
    var is_affiche_et=true;
    var is_affiche_et_prec=true;
    var all={};
    var verif=[];
    var verif_complet=[];
    var is_trouve=false;
  
    $.each(numero, function(index, value)
	{

		verif_complet=[];
		var tour= index.split(',');//Je split sur l'inde du numero qui m'indique les où possibles
		var elencours=value;//Je retrouve le nom de l'index du champ dans numero, par exemple, numero["id_type_info_conseil"]="id_type_info_conseil";
		
		//console.log(tour);

		//var tournb=tour.length;
		//if(tournb>1){ var is_or=true;} else {var is_or=false; }

		//Chaque each doit correspondre à une OU (règle si un OU s'avère TRUE alors le champ s'affiche
		$.each(tour, function(tourex,valex)
		{
			if(valex=="id_type_info_conseil")
			{
					//console.log(tourex);
			//console.log(valex);
			//console.log(elencours);
			//console.log(tourex)
			}
		
			//var ici="titi";
			//console.log(ici);
	    	//debut d'un tour de OU
	    	var verif=[];
	
			if(typeof(scenario[valex]) != "undefined" && scenario[valex] !== null) 
			{
				//console.log("toto");
				var scarray=scenario[valex].split(";");//connaître les pairs de ET, à chaque fois numéro de l'élement suivit de  sa valeur
				$.each(scarray, function(scarrex,valscarrex)
				{
					//valscarrex me renvoie la valeurs que je dois veirfier, par exemple, 10,1 (=valscarrex) pour id_type_info_conseil
					
					//Je vérifie une paire 
					var scarraypaire=valscarrex.split(",");
					var el=element[scarraypaire[0]];
					var vel=scarraypaire[1];
					/*if(valex=="id_type_info_conseil")
					{
						console.log(scarrex);
						console.log(valscarrex);
						console.log(vel);// id_type de demande doit être à 1 pour infotypeconseil s'affiche
						console.log(el);//contient id_type_demande
					}*/
					//console.log(el);
					if($("input[value='"+vel+"']",$(".tr_fiche_"+el,container_encours).find($(".formcourscopy"))).is(':visible')) 
					{
							if($("input[value='"+vel+"']",$(".tr_fiche_"+el,container_encours).find($(".formcourscopy"))).is(':checked'))
							{
								verif.push(true);//a chaque boucle, je met true or false, si la paire est rencontré ou pas
							}
							else
							{
								verif.push(false);
							}
							//alert("edit");
							/*if(valex=="id_type_info_conseil")
							{
								console.log(verif);
							}*/
					}
					else
					{
							if($("input[value='"+vel+"']",$(".tr_fiche_"+el,container_encours).find($(".formcourscopy"))).is(':checked'))
							{
								verif.push(true);//a chaque boucle, je met true or false, si la paire est rencontré ou pas
							}
							else
							{
								verif.push(false);
							}
							//alert("lecture");
					}
					/*if(valex=="id_type_info_conseil")
					{
						alert(el+"="+vel+":"+verif);

					}*/
					//Je fini la pair TOUT EST OK ICI
				});
				
				//une fois fini d'exploiter les et, je regarde qui l'emporte au final, si il y a un false alors le resultat est un false
				

				$.each(verif, function(verifk,verifv)
				{

					/*if(valex=="id_type_info_conseil")
							{
								console.log(verifv);
							}*/
					if(!verifv)
					{
						is_trouve=true;
					}//Si je trouve un false, c'est que la pair est false
				});

				/*if(valex=="id_type_info_conseil")
							{
								console.log(is_trouve);
							}*/
				//je stocke le résultat final dans une variable qui gère les OU possibles
				if(is_trouve)
				{
					verif_complet.push(false);
				}
				else{
					verif_complet.push(true);
				};
					
				
				is_trouve=false;

				/*if(valex=="id_type_info_conseil")
							{
								console.log(verif_complet);
							}*/
		}
	    
	  //Fin d'un OU
	});


	//Fin de la boucle d'un éelement à afficher
		
		$.each(verif_complet, function(verifck,verifcv)
		{
			
		    if(verifcv){ is_affiche=true;}//si je trouve un true alors je peux afficher afficher
		});
		//console.log(elencours);
		// console.log(is_affiche);
		
		if(is_affiche)
		{
			
		    $(".tr_fiche_"+elencours,container_encours).show();

		}
		else
		{
			//alert(elencours);
		    $(".tr_fiche_"+elencours,container_encours).hide().find("input[type='checkbox']").attr("checked",false);		    
		    $(".tr_fiche_"+elencours,container_encours).hide().find("input[type='text']").val("");
		    $(".tr_fiche_"+elencours,container_encours).hide().find("select").val(0);
		    $(".tr_fiche_"+elencours,container_encours).hide().find("select").trigger("chosen:updated");
		    var type_i= $(".tr_fiche_"+elencours,container_encours).find("input[name='"+elencours+"']").attr("type");
		    if(type_i==="hidden")
		    {
				$(".tr_fiche_"+elencours,container_encours).find("input[name='"+elencours+"']").val(0);
		    }
		}
		
		is_affiche=false;
		is_affiche_et=true;
		is_affiche_et_prec=true;
		verif_complet=[];
		verif=[];
    }); 
    
  return false;
  }
    

    

function set_input_form_indirect(container,id_associe)
{
    //alert();
    $("."+container).val(id_associe);
    $(".masque_"+container).hide();
    $(".a_"+container).show();
    $(".minus_"+container).show();
    
    var adresse="<?php echo base_url();?>/app/get_"+container+"/"+id_associe;
       jQuery.ajax
		    ({	
			   type:'POST',
			    url: adresse,
			    //data: dataString,
			    cache: false,
			     dataType: 'json',
			    success: function(data)
			    { 
				//alert(html);
				$(".a_"+container).html(data.value);
				$(".a_"+container).attr("href-title",data.href_title);
				$(".a_"+container).attr("href-ajax",data.href_ajax);
				$(".a_"+container).attr("href",data.href);
			    }
			    
		    });
    
    
}

jQuery(document).ready(function()
{
	


	$(".card").each(function()
		{
			//alert();
			set_ssth($(".card"));
			
		}

	);

	$(document).on('click','.search_demandeur_potentiel',function(evt){
	    $(".doublon_nom").show();
	    var container=$(this).closest(".tr_fiche_id_demandeur");
	    var nom=$("input[name='nom_personne_no_obligatoire']",container).val();
	    //alert(nom);
	    var prenom=$("input[name='prenom_personne_no_obligatoire']",container).val();
	    
	    var email=$("input[name='email_personne']",container).val();
	    var telephone=$("input[name='telephone_personne']",container).val();
	    //alert(prenom);
	    var dataString="nom="+nom+"&prenom="+prenom+"&email="+email+"&telephone="+telephone;
	    //alert(dataString);
	    $(".doublon_nom",container).html("<i class='fa fa-spin fa-spinner'></i> Recherche de demandeurs")
	    var adresse="<?php echo base_url();?>fh/fhc_dao/verif_nom_doublon_complet";
		jQuery.ajax
		    ({	
			    type:'POST',
			    url: adresse,
			    data: dataString,
			    cache: false,
			   
			    success: function(html)
			    { 
				//alert(html);
				$(".doublon_nom",container).show().html(html);
				//var row=form.closest(".row");
				//$(".doublon_nom_large").show().html(html);
				
			    }
			})
    
	    return false;
	});
	
	$(document).on('click','.ascroll',function(evt){ 
       // bloquer le comportement par défaut: on ne rechargera pas la page
       evt.preventDefault(); 
       // enregistre la valeur de l'attribut  href dans la variable target
	var target = $(this).attr('href');
	var position=$(target).offset().top-100;
       /* le sélecteur $(html, body) permet de corriger un bug sur chrome 
       et safari (webkit) */
	$('html, body')
       // on arrête toutes les animations en cours 
       .stop()
       /* on fait maintenant l'animation vers le haut (scrollTop) vers 
        notre ancre target */
       .animate({scrollTop: position}, 500 );
    });
	
	//alert("raejs");
	/*---------*/
	/*$(".tr_fiche_demande_id_th_acoustique").hide();
	$(".tr_fiche_demande_id_th_energie").hide();
	$(".tr_fiche_demande_id_th_logement").hide();
	$(".tr_fiche_demande_id_th_patrimoine").hide();
	$(".tr_fiche_demande_id_th_renovation").hide();
	$(".tr_fiche_demande_id_th_urbanisme").hide();*/
	<?php if(!isset($id_demande)): $id_demande=0; endif;?>
	<?php if($id_demande>0):?>
		
		var adresse="<?php echo base_url();?>fh/fhc_dao/get_fiche/<?php echo $id_demande;?>";
		var adresse_title="<?php echo base_url();?>fh/fhc_dao/get_fiche_title/<?php echo $id_demande;?>";
		var descriptor="fhd_liste_demande";
		var dataString="descriptor="+descriptor;
		
		   // alert(data_string);
		//load_fiche(adresse, adresse_title, descriptor, dataString);
		
	<?php endif;?>	
	
	$('#modal_content_mail_outlook').on('show.bs.modal', function (e) {
	    
		var calcul_hauteur_modal=window.innerHeight-200;
				$(".modal-body").css("max-height",calcul_hauteur_modal+"px");
				var calcul_hauteur_iframe=window.innerHeight-250;
		  $("iframe",".modal-body").css("height",calcul_hauteur_iframe+"px");
	    });
	
	
	$(document).off("click",".tab_ajax_dao[fh_dao_hook_controller='get_historique_demande']").on("click",".tab_ajax_dao[fh_dao_hook_controller='get_historique_demande']", function(e)
	{
	    $(".tab_reload_historique").trigger("click");
	});
	
	
	
	$(document).off("change","input[name_checkbox='demande_id_thematique_principal']").on("change","input[name_checkbox='demande_id_thematique_principal']", function(e){
	 
	    //alert();
	var check=$(this);
	    var val=check.val();
	    if(check.is(':checked'))
	    {
		$("input[name_checkbox='demande_id_thematique_secondaire']").each(function(){
		   $(this).show();
		   if($(this).val()===val)
		   {
		       $(this).prop("checked",false).hide();
		       //$(this).closest(".label_checkbox").hide();
		      
		   }   
		    
		});
		
	
	    }
	    else
	    {
		$("input[name_checkbox='demande_id_thematique_secondaire']").each(function(){
		   $(this).show();
		});
	    }	
	 //set_ssth();
	});    
    
	$(document).off("click","input[name_checkbox='visite_demande_id_thematique_principal']").on("click","input[name_checkbox='visite_demande_id_thematique_principal']", function(e){
	  
	
	var check=$(this);
	    var val=check.val();
	    if(check.is(':checked'))
	    {
		$("input[name_checkbox='visite_demande_id_thematique_secondaire']").each(function(){
		   $(this).show();
		   if($(this).val()===val)
		   {
		       $(this).prop("checked",false).hide();
		       //$(this).closest(".label_checkbox").hide();
		      
		   }   
		    
		});
		
	
	    }
	    else
	    {
		$("input[name_checkbox='visite_demande_id_thematique_secondaire']").each(function(){
		   $(this).show();
		});
	    }	
	 //set_ssth();
	});  
	
	$(document).off("click","input[name_checkbox='accompagnement_demande_id_thematique_principal']").on("click","input[name_checkbox='accompagnement_demande_id_thematique_principal']", function(e){
	  
	 //alert();
	var check=$(this);
	    var val=check.val();
	    if(check.is(':checked'))
	    {
		$("input[name_checkbox='accompagnement_demande_id_thematique_secondaire']").each(function(){
		   $(this).show();
		   if($(this).val()===val)
		   {
		       $(this).prop("checked",false).hide();
		       //$(this).closest(".label_checkbox").hide();
		      
		   }   
		    
		});
		
	
	    }
	    else
	    {
		$("input[name_checkbox='accompagnement_demande_id_thematique_secondaire']").each(function(){
		   $(this).show();
		});
	    }	
	   
	 //set_ssth();
	}); 
	   
	
	$(document).off("change","input[type='checkbox']").on("change","input[type='checkbox']", function(e){
	 var container_encours=$(this).closest(".load_ajax");

	  set_ssth(container_encours);
	   
	   	
	});
	
	$(document).off("change","input[type='radio']").on("change","input[type='radio']", function(e){
	 var container_encours=$(this).closest(".load_ajax");

	  set_ssth(container_encours);
	    if($(this).hasClass("ssth_direct")){
	     // alert("toto");
	  //set_ssth();
	    }
	   	
	});
	
	
	
	
	
	
	$(document).off("click","input[name_checkbox='demande_id_type_accompagnement']").on("click","input[name_checkbox='demande_id_type_accompagnement']", function(e){
	var container_form=$(this).closest(".form_submit");
	$("input[name_checkbox='demande_id_thematique_principal']",container_form).prop("checked",false);
	 $("input[name_checkbox='demande_id_thematique_secondaire']",container_form).show();
	   	var container_encours=$(this).closest(".load_ajax");
	 
	 if($(this).is(':checked')){
	     container_form.find(".tr_fiche_demande_id_thematique_principal").find(".control-label").text("Thématique d'entrée");
	     container_form.find(".tr_fiche_demande_id_type_accompagnement").find(".control-label").text("* Type d'acc. spécifique");
	     $("input[name='demande_id_thematique_principal']",container_form).val(0);
	 }
	 else
	 {
	    container_form.find(".tr_fiche_demande_id_thematique_principal").find(".control-label").text("* Thématique d'entrée");
	    container_form.find(".tr_fiche_demande_id_type_accompagnement").find(".control-label").text("* Type d'acc. spécifique");
	}
	  set_ssth(container_encours);
	});
	
	
	
	
	
	$(document).off("click","input[name_checkbox='demande_id_thematique_principal']").on("click","input[name_checkbox='demande_id_thematique_principal']", function(e){
	var container_form=$(this).closest(".form_submit"); 
	
	$("input[name_checkbox='demande_id_type_accompagnement']",container_form).prop("checked",false);
	
	   	var container_encours=$(this).closest(".load_ajax");
	 
	 if($(this).is(':checked')){
	     container_form.find(".tr_fiche_demande_id_type_accompagnement").find(".control-label").text("Type d'acc. spécifique");
	      container_form.find(".tr_fiche_demande_id_thematique_principal").find(".control-label").text("* Thématique d'entrée");
	      $("input[name='demande_id_type_accompagnement']",container_form).val(0);
	 }
	 else
	 {
	     container_form.find(".tr_fiche_demande_id_thematique_principal").find(".control-label").text("* Thématique d'entrée");
	    container_form.find(".tr_fiche_demande_id_type_accompagnement").find(".control-label").text("* Type d'acc. spécifique");
	}
	
	
	
	
	  //set_ssth(container_encours);
	});
	

	/*$(document).off("change",".ssth_direct").on("change",".ssth_direct", function(e){
		var container_encours=$(this).closest(".load_ajax");

	 set_ssth(container_encours);
	});*/
	
	$(document).off("change","input[name_checkbox='accompagnement_demande_id_type_accompagnement']").on("change","input[name_checkbox='accompagnement_demande_id_type_accompagnement']", function(e){
	    
	 $("input[name_checkbox='accompagnement_demande_id_thematique_principal']").prop("checked",false);
	 $("input[name='accompagnement_demande_id_thematique_principal']").val(null);
	 $("input[name_checkbox='accompagnement_demande_id_thematique_secondaire']").show();
	   	var container_encours=$(this).closest(".load_ajax");
	 
	  set_ssth(container_encours);
	});
	
	$(document).off("change","input[name_checkbox='accompagnement_demande_id_thematique_principal']").on("change","input[name_checkbox='accompagnement_demande_id_thematique_principal']", function(e){
	 $("input[name_checkbox='accompagnement_demande_id_type_accompagnement']").prop("checked",false);
	$("input[name='accompagnement_demande_id_type_accompagnement']").val(null);
	   	var container_encours=$(this).closest(".load_ajax");
	 
	  set_ssth(container_encours);
	});
	
	
	
	
	function set_obligatoire()
	{
	    //variable
	    var val_information=false;
	    var val_accompagnement=false;
	    var val_visite=false;
	    var val_information_suivi=false;
	    $("input[name_checkbox='id_type_demande']").each(function(){
		
		var el=$(this);
		var val_el=el.val();
		
		if(val_el==="1")
		{
		    if(el.is(':checked')){ val_information=true;} 
		}
		if(val_el==="2")
		{
		    if(el.is(':checked')){ val_visite=true;} 
		}
		if(val_el==="3")
		{
		    if(el.is(':checked')){ val_accompagnement=true;} 
		}
	    });
	   // alert(val_visite);
	    if($("input[name='is_occupe']").is(':checked')){ val_information_suivi=true; };
	    //traitement
	    if(val_visite)
	    {
		//ondoit connaitre le bien
		$(".tr_fiche_adresse_fr_bien").find(".control-label").html("* Adresse FR");
		$(".tr_fiche_adresse_nl_bien").find(".control-label").html("* Adresse NL");
		$(".tr_fiche_id_type_bien_coche").find(".control-label").html("* Type");
	    }
	    if(!val_visite)
	    {
		//ondoit connaitre le bien
		$(".tr_fiche_adresse_fr_bien").find(".control-label").html("Adresse FR");
		$(".tr_fiche_adresse_nl_bien").find(".control-label").html("Adresse NL");
		$(".tr_fiche_id_type_bien_coche").find(".control-label").html("Type");
	    }
	    <?php if($interface!=="outlook"&&$interface!=="stand"): ?>

	    if(val_visite||val_accompagnement||(val_information&&val_information_suivi))
	    {
		  $(".tr_fiche_rel_personne_bien").find(".control-label").html("Profil du demandeur");
		  $(".tr_fiche_nom_personne_no_obligatoire").find(".control-label").html("* Nom");
		  $(".tr_fiche_rel_personne_bien").find(".control-label").html("Profil du demandeur");
		  $(".tr_fiche_email_personne").find(".control-label").html("** Email");
		  $(".tr_fiche_telephone_personne").find(".control-label").html("** Téléphone");
		  $(".tr_fiche_adresse_personne").find(".control-label").html("** Adresse de contact");
		  $(".tr_fiche_localite_personne").find(".control-label").html("** Localité");
		  $(".tr_fiche_pays_personne").find(".control-label").html("** Pays");
		  $(".message_obligatoire_contact").show();
		
	    }
	    else
	    {
		  $(".tr_fiche_rel_personne_bien").find(".control-label").html("Profil du demandeur");
		  $(".tr_fiche_nom_personne_no_obligatoire").find(".control-label").html("Nom");
		  $(".tr_fiche_rel_personne_bien").find(".control-label").html("Profil du demandeur");
		  $(".tr_fiche_email_personne").find(".control-label").html("Email");
		  $(".tr_fiche_telephone_personne").find(".control-label").html("Téléphone");
		  $(".tr_fiche_adresse_personne").find(".control-label").html("Adresse de contact");
		  $(".tr_fiche_localite_personne").find(".control-label").html("Localité");
		  $(".tr_fiche_pays_personne").find(".control-label").html("Pays");
		  $(".message_obligatoire_contact").hide();
	    }
	    <?php else: ?>
		if(val_visite)
		{
		  $(".tr_fiche_adresse_fr_bien").find(".control-label").html("Adresse FR");
		$(".tr_fiche_adresse_nl_bien").find(".control-label").html("Adresse NL");
		$(".tr_fiche_id_type_bien_coche").find(".control-label").html("Type");
		}
//		
//		if(val_accompagnement)
//		{
//		    $(".tr_fiche_adresse_fr_bien").find(".control-label").html("* Adresse FR");
//		    $(".tr_fiche_adresse_nl_bien").find(".control-label").html("* Adresse NL");
//		    $(".tr_fiche_id_type_bien_coche").find(".control-label").html("* Type");
//		}
		
	    
	    <?php endif;?>
	}
	
	
	
	$(document).off("click","input[name='is_occupe']").on("click","input[name='is_occupe']", function(e){
	    set_obligatoire();
	});


	$(document).off("change","input[name='id_type_bien_coche']").on("change","input[name='id_type_bien_coche']", function(e){
	    set_obligatoire();
	});


	$(document).off("click","input[name_checkbox='id_type_demande']").on("click","input[name_checkbox='id_type_demande']", function(e){
	  //alert();
	  //set_ssth();
	  set_obligatoire();
	  var el=$(this);
	  if(el.is(':checked'))
	  {
	      var val=el.val();
	      if(val==="1")
	      { 
		  $(".c_demande_information").show();
		  $(".scinformation").show();
		    //updateTextareaHeight(c);
		
		}
		if(val==="2")
	      { 
		  $(".c_demande_visite").show();
		  $(".scvisite").show();

		  
		  
		 
		  
		}
		if(val==="3")
	      { 
		  $(".c_demande_accompagnement").show();
		  $(".scaccompagnement").show();
		   $(".tr_fiche_id_type_bien_coche").find(".control-label").html("Type");
		  
		   //SI aussi type information/conseil est nécessite de suivi, amors tout le truc en bas,
		   //
//		  $(".tr_fiche_nom_personne_no_obligatoire").find(".control-label").html("* Nom");
//		  $(".tr_fiche_rel_personne_bien").find(".control-label").html("* Profil du demandeur");
//		  $(".tr_fiche_email_personne").find(".control-label").html("** Email");
//		  $(".tr_fiche_telephone_personne").find(".control-label").html("** Téléphone");
//		  $(".tr_fiche_adresse_personne").find(".control-label").html("** Adresse de contact");
//		  $(".tr_fiche_localite_personne").find(".control-label").html("** Localité");
//		  $(".tr_fiche_pays_personne").find(".control-label").html("** Pays");
		  
		  
		  //Outlook, premier contact n'est pas onligatoire, jamais en outllok, obligatoire dans aucun cas, 
		  //obligatoire email pour outllook, pas obigatoire pour le type de visite
		  
		  //bureau, la durée du contact n'ewt pas obligatoire, après comme telephone et guichet
		  
		  
		  //obligatoire le sujet quand information avec suivi, acocmpagnement et visite
		  
		}
	
		$.each($('textarea'), function() 
			{
				var offset = this.offsetHeight - this.clientHeight;
				var resizeTextarea = function(e) {
					$(e).css('height', 'auto').css('height', e.scrollHeight + offset);
				};
				$(this).on('keyup input', function() { resizeTextarea(this); });
				resizeTextarea(this);
    		});
	      
	}
	else
	{
	    var val=el.val();
	      if(val==="1")
	      { 
		  $(".c_demande_information").hide();
		  $(".scinformation").hide();

		  

		}
		if(val==="2")
	      { 
		  $(".c_demande_visite").hide();
		  $(".scvisite").hide();
//		  $(".tr_fiche_adresse_fr_bien").find(".control-label").html("Adresse FR");
//		  $(".tr_fiche_adresse_nl_bien").find(".control-label").html("Adresse NL");
//		  $(".tr_fiche_id_type_bien_coche").find(".control-label").html("Type");
		}
		if(val==="3")
	      { 
		  $(".c_demande_accompagnement").hide();
		  $(".scaccompagnement").hide();
		 
		  
		  
		}
		
	
	}
	   	
	});
	
	/*------*/
    
	$(document).off("click",".reload_ajax_enquete").on("click",".reload_ajax_enquete", function(e){
	    
	var container=$(this).attr("aria-controls");
	    	   
	//$(".tab-pane-list").html("");
	$("#"+container).html("<div style='text-align:center; margin-top: 150px'><i class='fa fa-spin fa-spinner fa-4x'></i></div>");
	var adresse="<?php echo base_url();?>enquete/get_recap";
	     jQuery.ajax
		    ({	
			   type:'POST',
			    url: adresse,
			    //data: dataString,
			    cache: false,

			    success: function(html)
			    { 
				$("#"+container).html(html);
			    }
			    
		    });
	});   
	
	$(document).off("click",".reload_ajax_tb").on("click",".reload_ajax_tb", function(e){
	    
	var container=$(this).attr("aria-controls");
	    	   
	//$(".tab-pane-list").html("");
	$("#"+container).html("<div style='text-align:center; margin-top: 150px'><i class='fa fa-spin fa-spinner fa-4x'></i></div>");
	var adresse="<?php echo base_url();?>app/get_tb";
	     jQuery.ajax
		    ({	
			   type:'POST',
			    url: adresse,
			    //data: dataString,
			    cache: false,

			    success: function(html)
			    { 
				$("#"+container).html(html);
			    }
			    
		    });
	});  
   
	$(document).off("click",".reload_ajax").on("click",".reload_ajax", function(e){
	   if($(this).hasClass("is_empty")){
	       $(this).removeClass("is_empty");
	    var container=$(this).attr("aria-controls");
	   var descriptor=$(this).attr("fh_descriptor");
	   //$(".tab-pane-list").html("");
	   $("#"+container).html("<div style='text-align:center; margin-top: 150px'><i class='fa fa-spin fa-spinner fa-4x'></i></div>");
	   var adresse="<?php echo base_url();?>fh/fhc_dao/charge_direct_liste/20/"+descriptor;
	   
	   
	   
	        jQuery.ajax
		    ({	
			   type:'POST',
			    url: adresse,
			    //data: dataString,
			    cache: false,

			    success: function(html)
			    { 
				$("#"+container).html(html);
				set_ssth();
			    }
			    
		    });
	
	}
	});
  
    $(document).on("click",".minus_form_indirect", function(e){
	var container=$(this).attr("container");
	var string=$(".a_"+container).text();
	if(confirm("Etes-vous sûr de vouloir retirer "+string+" du formulaire ")){
	 
	 $("."+container).val(0);
	$(".masque_"+container).show();
	$(".a_"+container).hide();
	$(".minus_"+container).hide();
	$(".a_"+container).html("#");
	$(".a_"+container).attr("href-title","#");
	$(".a_"+container).attr("href-ajax","#");
	$(".a_"+container).attr("href","#");
    }
	//alert();
	});
	


 $(document).on("change","select", function(e){
	
	var value=$(this).val();
	var form_group=$(this).closest(".form-group");
	var label=$(this).closest(".form-group").find("label");
	$(".error_span",label).remove();
	var is_obligatoire=label.text().indexOf("*");
	
	if(is_obligatoire!="-1")
	    {
		
		if(value==="0")
		{
		  
		    label.append('<small class="error_span" style="color:red"><br>Information obligatoire</small>');
		    
		}
	    }
	    
	 if(form_group.hasClass("tr_fiche_id_type_demande"))
	 {
		if(value==="2"||value==="3"||value==="4")
		{
		    $(".label_demandeur").html("* Demandeur");
		    $(".label_bien").html("* Bien");
		}
		else
		{
		    $(".label_demandeur").html("Demandeur");
		    $(".label_bien").html("Bien");
		 }
	 }
     
    });   
    
    
     $(document).on("input","input", function(e){
	
	var value=$(this).val();
	var label=$(this).closest(".form-group").find("label");
	$(".error_span",label).remove();
	var is_obligatoire=label.text().indexOf("*");
	
	if(is_obligatoire!="-1")
	    {
		
		if(value==="")
		{
		  
		    label.append('<small class="error_span" style="color:red"><br>Information obligatoire</small>');
		    
		}
	    }
     
    }); 

	$(document).on("submit",".form_form_submit", function(e){

		return false;
	});


 $(document).on("click",".submit_permanence", function(e){

	$(".form_search_link_result").html("");
	$('.form_search_link').find(".itemSearch").val("");
    
	$(".error_general_count").html("");
	$(".error_fiche_information_count").html("");
	$(".error_fiche_accompagnement_count").html("");
	$(".error_fiche_visite_count").html("");
	$(".error_demandeur_count").html("");
	$(".error_bien_count").html("");
	$(".error_fin_count").html("");
	
	var cpermanence=$(this).closest(".container_form_permanence");

	var is_error_accomp=0;
	var is_error_contact=0;
	var is_error=0;
	var nb_general=0;
	var nb_demandeur=0;
	var nb_sujet=0;
	var nb_bien=0;
	var nb_information=0;
	var nb_accompagnement=0;
	var nb_visite=0;
	//$(".submit_permanence").removeClass("submit_permanence").addClass("attente_permanence").html("<i class='fa fa-spin fa-spinner'></i> Enregistrement en cours…");
	$(".submit_permanence").hide();
	$(".attente_permanence").show();

	//$("input[name=prenom_personne]").prop('disabled', false);
	//$("input[name=nom_personne]").prop('disabled', false);
	
	$(".error_span").each(function(){$(this).remove();});
	
	var fields=$(".form_form_submit",cpermanence).serializeArray();

	console.log(fields);
	
	var dataString="";
	var k=0;
	$(".form_form_submit",cpermanence).each(function(){ 
	    //alert();
	    if(k>0){ var et="&";} else{ var et="";};

	   	if($(this).find(".form-group").is(":visible")){dataString=dataString+et+$(this).serialize();}
	   k=k+1;
	});
	
	
	
	var id_entity_bien=$("input[name='id_entity_bien']").val();
	var id_entity_personne=$("input[name='id_entity_personne']").val();
	var id_message=$("input[name='id_message']").val();

	//var id_contact=$("input[name='id_contact']").not('#demandeurs_possible').val();
	//var id_contact_profil=$("input[name='id_contact_profil']").not('#demandeurs_possible').val();

	var id_contact=$("#id_contact_form").val();
	var id_contact_profil=$("#id_contact_profil_form").val();


	var interface=$("input[name='interface']").val();

	dataString=dataString+"&id_entity_bien="+id_entity_bien+"&id_entity_personne="+id_entity_personne+"&id_message="+id_message+"&interface="+interface+"&id_contact="+id_contact+"&id_contact_profil="+id_contact_profil;
	
	//alert(dataString);
	
	$(".tr_fiche",cpermanence).each(function()
	{

		var tr=$(this);
	
		var index=$(this).attr("index");
		var field=$('input[name='+index+']');
		var type=null;

		if(field.length)
		{
			type=field.attr("type");

		}
		else
		{
			
			field=$('input[name="'+index+'[]"]');
			if(field.length)
				{
					type=field.attr("type");
				}
				else
				{

					field=$('select[name='+index+']');
					//alert("test2")
					if(field.length)
					{
						type="select";
					}
					else
					{
						field=$('textarea[name='+index+']');
						if(field.length)
						{
							type="textarea";
						}
						
					}
				}
		}
	
		//alert(index);
			//alert(type);

		if(tr.is(":visible"))
		{
			
				//alert(index);

			/*if(type=="radio"||type=="checkbox")
			{
				var label=$("label",tr).not(".form-check-label");
				var is_obligatoire=label.text().indexOf("*");

				if(is_obligatoire!="-1")
				{
					
				}

			}
			else
			{*/
				var label=$("label",tr).not(".form-check-label");
				var is_obligatoire=label.text().indexOf("*");
				var is_find_error=false;

				if(is_obligatoire!="-1")
				{
					//Je suis obligatoire donc je dois vérifier

					if(type=="radio"||type=="checkbox")
					{
						is_find_error=true;
						
						field.each(function(){
							if($(this).is(':checked'))
							{
								is_find_error=false;
							}

						});
					}
					else
					{
						if(field.val()==="0" || field.val()===""  || field.val()===null )
						{
							is_find_error=true;
						}
					}


					if(is_find_error)
					{

						if
						(
							index==="accompagnement_demande_id_type_accompagnement"
							||index==="accompagnement_demande_id_thematique_principal"
						)
						{
							var val_accompagnement="0";
							var val_th_accompagnement="0";

							$("input[name='accompagnement_demande_id_type_accompagnement[]']").each(function(){
								if($(this).is(':checked'))
								{
									val_accompagnement=1;
								}
							});

							$("input[name='accompagnement_demande_id_thematique_principal']").each(function(){
								if($(this).is(':checked'))
								{
									val_th_accompagnement=1;
								}
							});

							//var val_accompagnement=$(".input_accompagnement_demande_id_type_accompagnement").val();


							//var val_th_accompagnement=$(".input_accompagnement_demande_id_thematique_principal").val();



							
							//alert(val_accompagnement);
							//alert(val_th_accompagnement);
							if(val_accompagnement==="0"&&val_th_accompagnement==="0"&&is_error_accomp===0)
							{
								is_error=1;
								is_error_accomp=1;
								$(".alert_accomp").html("<small class='error_span' style='color:red'><b>** Veuillez choisir soit un type d'accompagnement spécifique, soit une thématique d'entrée</b></small></div>");
								nb_accompagnement=nb_accompagnement+1;
								$(".error_fiche_accompagnement_count").html(nb_accompagnement+ " erreur(s)");
							}
						
						}
							<?php if($interface!=="outlook"&&$interface!=="stand"):?>
								else if(index==="email_personne"
										||index==="telephone_personne"
										||index==="adresse_personne"
										||index==="localite_personne"
										||index==="pays_personne")
								{
									var val_email_personne=$("input[name='email_personne']").val();
									var val_telephone_personne=$("input[name='telephone_personne']").val();
									var val_adresse_personne=$("input[name='adresse_personne']").val();
									var val_localite_personne=$("select[name='localite_personne']").val();
									var val_pays_personne=$("select[name='pays_personne']").val();
								
									if(val_email_personne===""&&val_telephone_personne===""&&(
										val_adresse_personne===""||val_localite_personne==="0")&&is_error_contact===0
										)
									{
									is_error=1;
									is_error_contact=1;
									$(".message_obligatoire_contact").html("<small class='error_span' style='color:red'><b>** Veuillez remplir soit le téléphone, l'email ou l'adresse/localité/pays</b></small></div>");
									nb_demandeur=nb_demandeur+1;
									$(".error_demandeur_count").html(nb_demandeur+ " erreur(s)");
									
									}
							
								}
							<?php endif;?>
						else
						{
							label.append('<small class="error_span" style="color:red"><br>Information obligatoire</small>');
							is_error=1;
							
							var contexte=tr.closest(".well").attr("id");
		
							switch(contexte)
							{
								
								case "tr_fiche_id_debut":
								nb_general=nb_general+1;
								$(".error_general_count").html(nb_general+ " erreur(s)");
								break;
								
								case "tr_fiche_information":
								nb_information=nb_information+1;
								$(".error_fiche_information_count").html(nb_information+ " erreur(s)");
								break;	
								
								case "tr_fiche_accompagnement":
								nb_accompagnement=nb_accompagnement+1;
								$(".error_fiche_accompagnement_count").html(nb_accompagnement+ " erreur(s)");
								break;	
								
								case "tr_fiche_visite":
								nb_visite=nb_visite+1;
								$(".error_fiche_visite_count").html(nb_visite+ " erreur(s)");
								break;	
								
								case "tr_fiche_id_demandeur":
								nb_demandeur=nb_demandeur+1;
								$(".error_demandeur_count").html(nb_demandeur+ " erreur(s)");
								break;
								
								case "tr_fiche_id_bien":
								nb_bien=nb_bien+1;
								$(".error_bien_count").html(nb_bien+ " erreur(s)");
								break;
								
								case "tr_fiche_id_fin":
								nb_sujet=nb_sujet+1;
								$(".error_fin_count").html(nb_sujet+ " erreur(s)");
								break;
							}
								
						}//fin de lese 

					}

				}	

			//}
		}

	});


/*
	jQuery.each( fields, function( i, field ) 
	{
		if(field.name!="urls_file[]")
		{
				//if ($("#monelement").is(":visible")){alert ("#monelement est visible");}
				var tr=$(".tr_fiche_"+field.name.replace("[]",null),cpermanence);
			
				if(tr.is(":visible"))
				{
				var label=$("label",tr).not(".label_checkbox");

				var is_obligatoire=label.text().indexOf("*");

				if(is_obligatoire!="-1")
				{
					if(field.value==="0" || field.value===""  || field.value===null )
					{
					
					if(field.name==="accompagnement_demande_id_type_accompagnement"
						||field.name==="accompagnement_demande_id_thematique_principal")
					{
						var val_accompagnement=$(".input_accompagnement_demande_id_type_accompagnement").val();
						var val_th_accompagnement=$(".input_accompagnement_demande_id_thematique_principal").val();
						
						//alert(val_accompagnement);
						//alert(val_th_accompagnement);
						if(val_accompagnement==="0"&&val_th_accompagnement==="0"&&is_error_accomp===0)
						{
						is_error=1;
						is_error_accomp=1;
						$(".alert_accomp").html("<small class='error_span' style='color:red'><b>** Veuillez choisir soit un type d'accompagnement spécifique, soit une thématique d'entrée</b></small></div>");
						nb_accompagnement=nb_accompagnement+1;
						$(".error_fiche_accompagnement_count").html(nb_accompagnement+ " erreur(s)");
						}
					
					}
					<?php if($interface!=="outlook"&&$interface!=="stand"):?>
					else if(field.name==="email_personne"
							||field.name==="telephone_personne"
							||field.name==="adresse_personne"
							||field.name==="localite_personne"
							||field.name==="pays_personne")
					{
						var val_email_personne=$("input[name='email_personne']").val();
						var val_telephone_personne=$("input[name='telephone_personne']").val();
						var val_adresse_personne=$("input[name='adresse_personne']").val();
						var val_localite_personne=$("select[name='localite_personne']").val();
						var val_pays_personne=$("select[name='pays_personne']").val();
					// alert(val_pays_personne+"toto");
						if(val_email_personne===""&&val_telephone_personne===""&&(
							val_adresse_personne===""||val_localite_personne==="0"||val_pays_personne==="0")&&is_error_contact===0
							)
						{
						is_error=1;
						is_error_contact=1;
						$(".message_obligatoire_contact").html("<small class='error_span' style='color:red'><b>** Veuillez remplir soit le téléphone, l'email ou l'adresse/localité/pays</b></small></div>");
						nb_demandeur=nb_demandeur+1;
						$(".error_demandeur_count").html(nb_demandeur+ " erreur(s)");
						
						}
						
					}
					<?php endif;?>
					
					else
					{
					label.append('<small class="error_span" style="color:red"><br>Information obligatoire</small>');
					is_error=1;
					
					var contexte=tr.closest(".well").attr("id");
					
					
					//alert(contexte);
					switch(contexte){
						
						case "tr_fiche_id_debut":
						nb_general=nb_general+1;
						$(".error_general_count").html(nb_general+ " erreur(s)");
						break;
						
						case "tr_fiche_information":
						nb_information=nb_information+1;
						$(".error_fiche_information_count").html(nb_information+ " erreur(s)");
						break;	
						
						case "tr_fiche_accompagnement":
						nb_accompagnement=nb_accompagnement+1;
						$(".error_fiche_accompagnement_count").html(nb_accompagnement+ " erreur(s)");
						break;	
						
						case "tr_fiche_visite":
						nb_visite=nb_visite+1;
						$(".error_fiche_visite_count").html(nb_visite+ " erreur(s)");
						break;	
						
						case "tr_fiche_id_demandeur":
						nb_demandeur=nb_demandeur+1;
						$(".error_demandeur_count").html(nb_demandeur+ " erreur(s)");
						break;
						
						case "tr_fiche_id_bien":
						nb_bien=nb_bien+1;
						$(".error_bien_count").html(nb_bien+ " erreur(s)");
						break;
						
						case "tr_fiche_id_fin":
						nb_sujet=nb_sujet+1;
						$(".error_fin_count").html(nb_sujet+ " erreur(s)");
						break;
						}
						
					}//fin de lese   
					
					
					
					}


				}
				}
		}
	});
	*/
	if(is_error===1)
	{
	     cpermanence.fadeOut(function(){
	    	
		cpermanence.fadeIn(function(){
		    
		    $(".submit_permanence").show();
		    $(".attente_permanence").hide();
		});
	    });
	}
	else
	{
	    var has_url_file=$(".has_url_file").val();
		if(has_url_file==1)
		{
			var ds=$(".form_url_file").serialize();
			dataString=dataString+"&"+ds;
		}

		var id_bien_tamo=$(".id_bien_tamo").val();

		if(id_bien_tamo!=0)
		{
			var dtam=$(".form_id_bien_tamo").serialize();
			//alert(dtam);
			dataString=dataString+"&"+dtam;
		}

		var id_deposit=$(".id_deposit").val();

		if(id_deposit!=0)
		{
			var dsit=$(".form_id_deposit").serialize();
			//alert(dtam);
			dataString=dataString+"&"+dsit;
		}
	
	    var container_good=$(this).closest(".container_form_permanence");
	    var adresse="<?php echo base_url();?>/demande/set_permanence";
	    //alert(dataString); return false;
	      jQuery.ajax
		    ({	
			   type:'POST',
			    url: adresse,
			    data: dataString,
			    cache: false,

			    success: function(html)
			    { 
				$(".container_insert_demande_principale").html(html);
				
				
			    }
			    
		    });
	    
	}

	return false;
	
    });

	$(document).off("click","input[name_checkbox='statut_rdv']").on("click","input[name_checkbox='statut_rdv']", function(e){
	 var val_encours=$(this).val();
	 var form=$(this).closest("form");
	 if(val_encours==="6"&&$(this).is(':checked')){
	   
	    $(".tr_fiche_date_rdv_debut",form).find(".control-label").html("Début");
	    $(".tr_fiche_date_rdv_fin",form).find(".control-label").html("Fin");
	   
	 }
	 else
	 {
	    $(".tr_fiche_date_rdv_debut",form).find(".control-label").html("* Début");
	    $(".tr_fiche_date_rdv_fin",form).find(".control-label").html("* Fin");
	}
 });
 
 	$(document).off("click",".btn_submit_upload").on("click",".btn_submit_upload", function(e){

	//alert();
		//$("#my-dropzone").submit();

		return false;
	});

	//alert();







	 /* $("input[name='temp_avant_rdv']").inputmask("99:99");
                $("input[name='temp_apres_rdv']").inputmask("99:99");

                $("input[name='date_rdv_debut_h']").inputmask("99:99");

                $("input[name='date_rdv_fin_h']").inputmask("99:99");

     

              Inputmask("datetime", {
                placeholder: "dd/mm/yyyy",
                inputFormat: "dd/MM/yyyy"
             
            }).mask('#date_rdv_fin');

            Inputmask("datetime", {
              placeholder: "dd/mm/yyyy",
              inputFormat: "dd/MM/yyyy"
           
           
          }).mask('#date_rdv_debut');*/

			$(document).on("click","input[type=radio]",function() 
      		{
				
				var radio=$(this);
				var name_radio=radio.attr("name");

				if(radio.hasClass("hasCheck"))
				{
					$("input[name="+name_radio+"]").removeClass("hasCheck");
					radio.prop("checked",false);
					radio.removeClass("hasCheck");
				}
				else
				{
					$("input[name="+name_radio+"]").removeClass("hasCheck");
					radio.prop("checked",true);
					radio.addClass("hasCheck");
				}
			});

		/*	$(document).on("click",".form_radio_label",function() 
      		{
				
				var radio=$(this).closest(".form-check").find("input[type=radio]");
				
				var name_radio=radio.attr("name");
				
				if(radio.hasClass("hasCheck"))
				{
					$("input[name="+name_radio+"]").removeClass("hasCheck");
					radio.prop("checked",false);
					radio.removeClass("hasCheck");
				}
				else
				{
					$("input[name="+name_radio+"]").removeClass("hasCheck");
					radio.prop("checked",true);
					radio.addClass("hasCheck");
				}
			});*/

	$(document).on("click","#renitialiser_demandeur",function() 
      {
        
		$("input[name=civilite_personne]").prop("checked",false);

          $("select[name=rel_personne_bien]").val(null);
		  $("input[name=prenom_personne]").val(null).attr("disabled",false);
		  $("input[name=nom_personne]").val(null).attr("disabled",false);
          $("input[name=email_personne]").val(null);
		  $("input[name=telephone_personne]").val(null);
		  $("input[name=adresse_personne]").val(null);
		  $("select[name=localite_personne]").val(null);
		  $("select[name=pays_personne]").val(null);
		  
		  //$("input[name=id_contact]").val(0);
		  //$("input[name=id_contact_profil]").val(0);

		  $("#id_contact_form").val(0);
		  $("#id_contact_profil_form").val(0);

          
      } );

});

$(document).ready(function() {
    if(window.location.href.includes("demande/new")) {
        // set required contact_duree, is_premier_contact, origine
        const contact_duree_text = $('.tr_fiche_demande_contact_duree').find('.control-label').text();
        $('.tr_fiche_demande_contact_duree').find('.control-label').text('*' + contact_duree_text);
        const is_premier_contact_text = $('.tr_fiche_demande_is_premier_contact').find('.control-label').text();
        $('.tr_fiche_demande_is_premier_contact').find('.control-label').text('*' + is_premier_contact_text);
        //const origine_text = $('.tr_fiche_demande_origine').find('.control-label').text();
    }
});

</script>


